(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     54059,       1285]
NotebookOptionsPosition[     52344,       1236]
NotebookOutlinePosition[     52701,       1252]
CellTagsIndexPosition[     52658,       1249]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Hardcoded", " ", "forces"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"f", " ", "=", " ", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x", ",", " ", "_Real"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"y", ",", " ", "_Real"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"k", ",", " ", "_Real"}], "}"}]}], " ", "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"-", "2."}], "*", "k", "*", "x"}], "+", 
         RowBox[{"k", "*", "y"}]}], ",", 
        RowBox[{
         RowBox[{"k", "*", "x"}], "-", 
         RowBox[{"2", "*", "k", "*", "y"}]}]}], "}"}]}], "]"}]}], 
   ";"}]}]], "Input",
 CellChangeTimes->{{3.759937672409348*^9, 
  3.759937677021545*^9}},ExpressionUUID->"3b5728da-ab62-4d0f-8732-\
7c8ae4d521ee"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{
   TagBox["CompiledFunction",
    "SummaryHead"], "[", 
   DynamicModuleBox[{Typeset`open$$ = False}, 
    PanelBox[
     PaneSelectorBox[{False->GridBox[{
        {
         PaneBox[
          ButtonBox[
           
           DynamicBox[FEPrivate`FrontEndResource[
            "FEBitmaps", "SquarePlusIconMedium"],
            ImageSizeCache->{12., {0., 12.}}],
           Appearance->None,
           ButtonFunction:>(Typeset`open$$ = True),
           Evaluator->Automatic,
           Method->"Preemptive"],
          Alignment->{Center, Center},
          
          ImageSize->
           Dynamic[{
            Automatic, 3.5 CurrentValue["FontCapHeight"]/AbsoluteCurrentValue[
             Magnification]}]], 
         GraphicsBox[{
           {Thickness[0.038461538461538464`], {
             {FaceForm[{GrayLevel[0.93], Opacity[1.]}], 
              FilledCurveBox[{{{1, 4, 3}, {0, 1, 0}, {1, 3, 3}, {0, 1, 0}, {1,
                3, 3}, {0, 1, 0}, {1, 3, 3}, {0, 1, 0}}}, {{{
               25.499999999999996`, 2.5}, {25.499999999999996`, 
               1.3953100000000003`}, {24.604699999999998`, 
               0.49999999999999994`}, {23.5, 0.49999999999999994`}, {2.5, 
               0.49999999999999994`}, {1.3953100000000003`, 
               0.49999999999999994`}, {0.49999999999999994`, 
               1.3953100000000003`}, {0.49999999999999994`, 2.5}, {
               0.49999999999999994`, 23.5}, {0.49999999999999994`, 
               24.604699999999998`}, {1.3953100000000003`, 
               25.499999999999996`}, {2.5, 25.499999999999996`}, {23.5, 
               25.499999999999996`}, {24.604699999999998`, 
               25.499999999999996`}, {25.499999999999996`, 
               24.604699999999998`}, {25.499999999999996`, 23.5}, {
               25.499999999999996`, 2.5}}}]}}, {
             {FaceForm[{RGBColor[0.5, 0.5, 0.5], Opacity[1.]}], 
              FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0,
                1, 0}, {0, 1, 0}, {0, 1, 0}}}, {{{20.5426, 
               19.116799999999998`}, {16.3832, 21.876199999999997`}, {16.3832,
                20.021499999999996`}, {6.930469999999999, 
               20.021499999999996`}, {6.930469999999999, 
               18.212100000000003`}, {16.3832, 18.212100000000003`}, {16.3832,
                16.357399999999995`}, {20.5426, 19.116799999999998`}}}], 
              FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0,
                1, 0}, {0, 1, 0}, {0, 1, 0}}}, {{{5.30508, 13.8391}, {9.46445,
                11.079700000000003`}, {9.46445, 12.933999999999997`}, {
               18.917199999999998`, 12.933999999999997`}, {
               18.917199999999998`, 14.7438}, {9.46445, 14.7438}, {9.46445, 
               16.598}, {5.30508, 13.8391}}}], 
              FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0,
                1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 
               0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 
               1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}}}, CompressedData["
1:eJxTTMoPSmVmYGBgBGIRIGYC4r9qIkoPPog5zJd34+ifoeBwf6HGBfU8aYe0
2dKXhaMEHT77F2xc1CQH52elHtL/aqrg0KrArnpmjpRDvTCXYEG9gsOOYKuI
/6tlHZ5WFpRfO4qQn3ww8NOrXYpw/fNmfE3SCFCG8z8EiLwQ7lSF2w82/44y
nM937b/lmXNKDnK7FuxLZZFwMDfq/3NwgpKDccaL+Q9miDok9Mnt3x6k5FDt
mbylT0ECwk9QhOuXWfO/eIajPCq/WNYh5kh50jV+CYc1eV/nfGGShZsXte2a
OGevDNy8ZqG0W/9KpeD60cMLAIwUgfU=
               "]], 
              FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0,
                1, 0}, {0, 1, 0}, {0, 1, 0}}}, {{{12.82453, 
               5.289294374999999}, {11.960858124999998`, 8.29796625}, {
               11.080858124999999`, 8.29796625}, {12.417186249999999`, 
               4.337966249999999}, {13.193201874999998`, 4.337966249999999}, {
               14.540701874999998`, 8.29796625}, {13.688201874999999`, 
               8.29796625}, {12.82453, 5.289294374999999}}}], 
              FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0,
                1, 0}, {1, 3, 3}, {1, 3, 3}, {0, 1, 0}, {0, 1, 0}, {0, 1, 
               0}, {1, 3, 3}, {1, 3, 3}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 
               1, 0}, {0, 1, 0}}}, CompressedData["
1:eJxTTMoPSmVmYGBgBGIpIGYC4qwFP+fsFjB0WFcz7fnBvSIOLFaTza6GGTjM
l3fj6J+h4GC9PHLBXXc9DH7abOnLwlGCDtPNZKaxndfH4Is8/uOrISAD53uI
GTRGxyP4O4KtIv6fR/BbFdhVz8TIOqj9FNyfdEbfIejt5Y8zXiL4h7TunbCJ
koPzweYvkXP4mfT+6PSlBnD7n25Z/mROiSGcr7S/rqPX1AiuHsaHmQfjw+zz
lubzZjYxgrsHxoe5F8aH+QfGn/B91VROQQQfZr/Ei1viF75j8mHh6eiSdevo
cUM4Hz0+AG0eosQ=
               "]]}}}},
          AspectRatio->1,
          Axes->False,
          Background->GrayLevel[0.93],
          Frame->True,
          FrameStyle->Directive[
            Thickness[Tiny], 
            GrayLevel[0.7]],
          FrameTicks->None,
          ImageSize->{Automatic, 
            Dynamic[
            3.5 (CurrentValue["FontCapHeight"]/AbsoluteCurrentValue[
              Magnification]), ImageSizeCache -> {45., {0., 9.}}]}], 
         GridBox[{
           {
            RowBox[{
             TagBox["\<\"Argument count: \"\>",
              "SummaryItemAnnotation"], "\[InvisibleSpace]", 
             TagBox["3",
              "SummaryItem"]}]},
           {
            RowBox[{
             TagBox["\<\"Argument types: \"\>",
              "SummaryItemAnnotation"], "\[InvisibleSpace]", 
             TagBox[
              StyleBox[
               PaneBox[
                RowBox[{"{", 
                 RowBox[{"_Real", ",", "_Real", ",", "_Real"}], "}"}],
                BaselinePosition->Baseline,
                ContentPadding->False,
                FrameMargins->0,
                ImageSize->{{1, 300}, Automatic},
                StripOnInput->True],
               LineBreakWithin->False],
              "SummaryItem"]}]}
          },
          AutoDelete->False,
          
          BaseStyle->{
           ShowStringCharacters -> False, NumberMarks -> False, 
            PrintPrecision -> 3, ShowSyntaxStyles -> False},
          GridBoxAlignment->{"Columns" -> {{Left}}, "Rows" -> {{Automatic}}},
          
          GridBoxItemSize->{
           "Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}},
          GridBoxSpacings->{"Columns" -> {{2}}, "Rows" -> {{Automatic}}}]}
       },
       AutoDelete->False,
       BaselinePosition->{1, 1},
       GridBoxAlignment->{"Rows" -> {{Top}}},
       GridBoxItemSize->{
        "Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}], True->
      GridBox[{
        {
         PaneBox[
          ButtonBox[
           
           DynamicBox[FEPrivate`FrontEndResource[
            "FEBitmaps", "SquareMinusIconMedium"]],
           Appearance->None,
           ButtonFunction:>(Typeset`open$$ = False),
           Evaluator->Automatic,
           Method->"Preemptive"],
          Alignment->{Center, Center},
          
          ImageSize->
           Dynamic[{
            Automatic, 3.5 CurrentValue["FontCapHeight"]/AbsoluteCurrentValue[
             Magnification]}]], 
         GraphicsBox[{
           {Thickness[0.038461538461538464`], {
             {FaceForm[{GrayLevel[0.93], Opacity[1.]}], 
              FilledCurveBox[{{{1, 4, 3}, {0, 1, 0}, {1, 3, 3}, {0, 1, 0}, {1,
                3, 3}, {0, 1, 0}, {1, 3, 3}, {0, 1, 0}}}, {{{
               25.499999999999996`, 2.5}, {25.499999999999996`, 
               1.3953100000000003`}, {24.604699999999998`, 
               0.49999999999999994`}, {23.5, 0.49999999999999994`}, {2.5, 
               0.49999999999999994`}, {1.3953100000000003`, 
               0.49999999999999994`}, {0.49999999999999994`, 
               1.3953100000000003`}, {0.49999999999999994`, 2.5}, {
               0.49999999999999994`, 23.5}, {0.49999999999999994`, 
               24.604699999999998`}, {1.3953100000000003`, 
               25.499999999999996`}, {2.5, 25.499999999999996`}, {23.5, 
               25.499999999999996`}, {24.604699999999998`, 
               25.499999999999996`}, {25.499999999999996`, 
               24.604699999999998`}, {25.499999999999996`, 23.5}, {
               25.499999999999996`, 2.5}}}]}}, {
             {FaceForm[{RGBColor[0.5, 0.5, 0.5], Opacity[1.]}], 
              FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0,
                1, 0}, {0, 1, 0}, {0, 1, 0}}}, {{{20.5426, 
               19.116799999999998`}, {16.3832, 21.876199999999997`}, {16.3832,
                20.021499999999996`}, {6.930469999999999, 
               20.021499999999996`}, {6.930469999999999, 
               18.212100000000003`}, {16.3832, 18.212100000000003`}, {16.3832,
                16.357399999999995`}, {20.5426, 19.116799999999998`}}}], 
              FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0,
                1, 0}, {0, 1, 0}, {0, 1, 0}}}, {{{5.30508, 13.8391}, {9.46445,
                11.079700000000003`}, {9.46445, 12.933999999999997`}, {
               18.917199999999998`, 12.933999999999997`}, {
               18.917199999999998`, 14.7438}, {9.46445, 14.7438}, {9.46445, 
               16.598}, {5.30508, 13.8391}}}], 
              FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0,
                1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 
               0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 
               1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}}}, CompressedData["
1:eJxTTMoPSmVmYGBgBGIRIGYC4r9qIkoPPog5zJd34+ifoeBwf6HGBfU8aYe0
2dKXhaMEHT77F2xc1CQH52elHtL/aqrg0KrArnpmjpRDvTCXYEG9gsOOYKuI
/6tlHZ5WFpRfO4qQn3ww8NOrXYpw/fNmfE3SCFCG8z8EiLwQ7lSF2w82/44y
nM937b/lmXNKDnK7FuxLZZFwMDfq/3NwgpKDccaL+Q9miDok9Mnt3x6k5FDt
mbylT0ECwk9QhOuXWfO/eIajPCq/WNYh5kh50jV+CYc1eV/nfGGShZsXte2a
OGevDNy8ZqG0W/9KpeD60cMLAIwUgfU=
               "]], 
              FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0,
                1, 0}, {0, 1, 0}, {0, 1, 0}}}, {{{12.82453, 
               5.289294374999999}, {11.960858124999998`, 8.29796625}, {
               11.080858124999999`, 8.29796625}, {12.417186249999999`, 
               4.337966249999999}, {13.193201874999998`, 4.337966249999999}, {
               14.540701874999998`, 8.29796625}, {13.688201874999999`, 
               8.29796625}, {12.82453, 5.289294374999999}}}], 
              FilledCurveBox[{{{0, 2, 0}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0,
                1, 0}, {1, 3, 3}, {1, 3, 3}, {0, 1, 0}, {0, 1, 0}, {0, 1, 
               0}, {1, 3, 3}, {1, 3, 3}, {0, 1, 0}, {0, 1, 0}, {0, 1, 0}, {0, 
               1, 0}, {0, 1, 0}}}, CompressedData["
1:eJxTTMoPSmVmYGBgBGIpIGYC4qwFP+fsFjB0WFcz7fnBvSIOLFaTza6GGTjM
l3fj6J+h4GC9PHLBXXc9DH7abOnLwlGCDtPNZKaxndfH4Is8/uOrISAD53uI
GTRGxyP4O4KtIv6fR/BbFdhVz8TIOqj9FNyfdEbfIejt5Y8zXiL4h7TunbCJ
koPzweYvkXP4mfT+6PSlBnD7n25Z/mROiSGcr7S/rqPX1AiuHsaHmQfjw+zz
lubzZjYxgrsHxoe5F8aH+QfGn/B91VROQQQfZr/Ei1viF75j8mHh6eiSdevo
cUM4Hz0+AG0eosQ=
               "]]}}}},
          AspectRatio->1,
          Axes->False,
          Background->GrayLevel[0.93],
          Frame->True,
          FrameStyle->Directive[
            Thickness[Tiny], 
            GrayLevel[0.7]],
          FrameTicks->None,
          ImageSize->{Automatic, 
            Dynamic[
            3.5 (CurrentValue["FontCapHeight"]/AbsoluteCurrentValue[
              Magnification]), ImageSizeCache -> {45., {0., 9.}}]}], 
         GridBox[{
           {
            RowBox[{
             TagBox["\<\"Argument count: \"\>",
              "SummaryItemAnnotation"], "\[InvisibleSpace]", 
             TagBox["3",
              "SummaryItem"]}]},
           {
            RowBox[{
             TagBox["\<\"Argument types: \"\>",
              "SummaryItemAnnotation"], "\[InvisibleSpace]", 
             TagBox[
              PaneBox[
               RowBox[{"{", 
                RowBox[{"_Real", ",", "_Real", ",", "_Real"}], "}"}],
               BaselinePosition->Baseline,
               ContentPadding->False,
               FrameMargins->0,
               ImageSize->{{1, 500}, Automatic},
               StripOnInput->True],
              "SummaryItem"]}]},
           {
            RowBox[{
             TagBox["\<\"Variables: \"\>",
              "SummaryItemAnnotation"], "\[InvisibleSpace]", 
             TagBox[
              RowBox[{"{", 
               RowBox[{"x", ",", "y", ",", "k"}], "}"}],
              "SummaryItem"]}]},
           {
            RowBox[{
             TagBox["\<\"Expression: \"\>",
              "SummaryItemAnnotation"], "\[InvisibleSpace]", 
             TagBox[
              PaneBox[
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", "2.`"}], " ", "k", " ", "x"}], "+", 
                  RowBox[{"k", " ", "y"}]}], ",", 
                 RowBox[{
                  RowBox[{"k", " ", "x"}], "-", 
                  RowBox[{"2", " ", "k", " ", "y"}]}]}], "}"}],
               BaselinePosition->Baseline,
               ContentPadding->False,
               FrameMargins->0,
               ImageSize->{{1, 500}, Automatic},
               StripOnInput->True],
              "SummaryItem"]}]}
          },
          AutoDelete->False,
          
          BaseStyle->{
           ShowStringCharacters -> False, NumberMarks -> False, 
            PrintPrecision -> 3, ShowSyntaxStyles -> False},
          GridBoxAlignment->{"Columns" -> {{Left}}, "Rows" -> {{Automatic}}},
          
          GridBoxItemSize->{
           "Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}},
          GridBoxSpacings->{"Columns" -> {{2}}, "Rows" -> {{Automatic}}}]}
       },
       AutoDelete->False,
       BaselinePosition->{1, 1},
       GridBoxAlignment->{"Rows" -> {{Top}}},
       GridBoxItemSize->{
        "Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}]}, Dynamic[
      Typeset`open$$],
      ImageSize->Automatic],
     BaselinePosition->Baseline],
    DynamicModuleValues:>{}], "]"}],
  CompiledFunction[{10, 11.1, 5468}, {
    Blank[Real], 
    Blank[Real], 
    Blank[Real]}, {{3, 0, 0}, {3, 0, 1}, {3, 0, 2}, {3, 1, 
   0}}, {{2, {2, 0, 0}}, {-2., {3, 0, 3}}}, {0, 1, 8, 0, 
   1}, {{16, 3, 2, 0, 4}, {16, 2, 1, 5}, {13, 4, 5, 4}, {16, 2, 0, 5}, {10, 0,
     6}, {16, 6, 2, 1, 6}, {19, 6, 7}, {13, 5, 7, 5}, {34, 1, 2, 4, 5, 3, 
    0}, {1}}, 
   Function[{$CellContext`x, $CellContext`y, $CellContext`k}, {(-2.) \
$CellContext`k $CellContext`x + $CellContext`k $CellContext`y, $CellContext`k \
$CellContext`x - 2 $CellContext`k $CellContext`y}], Evaluate],
  Editable->False,
  SelectWithContents->True,
  Selectable->False]], "Output",
 CellChangeTimes->{3.7047253488705873`*^9, 3.7047289800592003`*^9, 
  3.704729054438085*^9, 3.7047292737018557`*^9, 3.704729467281253*^9, 
  3.70473120767983*^9, 3.705945812884571*^9, 3.707145244048006*^9, 
  3.7071648510167418`*^9, 
  3.707216138462379*^9},ExpressionUUID->"29c3bb76-8707-40f5-8b5b-\
a3a6e977502e"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"k", " ", "=", "1."}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"<<", "MaTeX`"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AllNeighbors", " ", "=", " ", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"i", ",", " ", "_Integer"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"sqrtlenfpoints", ",", " ", "_Integer"}], "}"}]}], "}"}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "First", " ", "handle", " ", "the", " ", "four", " ", "corners"}], " ",
        "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"i", "\[Equal]", "1"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"2", ",", " ", 
          RowBox[{"sqrtlenfpoints", "+", "1"}]}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"i", "\[Equal]", "sqrtlenfpoints"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"sqrtlenfpoints", " ", "-", " ", "1"}], ",", " ", 
            RowBox[{"2", " ", "sqrtlenfpoints"}]}], "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"i", "\[Equal]", 
             RowBox[{
              RowBox[{"sqrtlenfpoints", "^", "2"}], "-", "sqrtlenfpoints", 
              "+", "1"}]}], ",", " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"sqrtlenfpoints", "^", "2"}], "-", 
               RowBox[{"2", "sqrtlenfpoints"}], "+", "1"}], ",", " ", 
              RowBox[{
               RowBox[{"sqrtlenfpoints", "^", "2"}], "-", "sqrtlenfpoints", 
               "+", "2"}]}], "}"}], ",", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"i", "\[Equal]", 
               RowBox[{"sqrtlenfpoints", "^", "2"}]}], ",", " ", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{"sqrtlenfpoints", "^", "2"}], "-", "1"}], ",", " ", 
                RowBox[{
                 RowBox[{"sqrtlenfpoints", "^", "2"}], "-", 
                 "sqrtlenfpoints"}]}], "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
               "Then", " ", "handle", " ", "the", " ", "top", " ", "and", " ",
                 "bottom", " ", "boundary"}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"1", "<", "i", "<", "sqrtlenfpoints"}], ",", " ", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"i", "-", "1"}], ",", " ", 
                  RowBox[{"i", "+", "1"}], ",", " ", 
                  RowBox[{"i", "+", "sqrtlenfpoints"}]}], "}"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"sqrtlenfpoints", "^", "2"}], "-", 
                    "sqrtlenfpoints", "+", "1"}], "<", "i", "<", 
                   RowBox[{"sqrtlenfpoints", "^", "2"}]}], ",", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"i", "-", "1"}], ",", " ", 
                    RowBox[{"i", "+", "1"}], ",", " ", 
                    RowBox[{"i", "-", "sqrtlenfpoints"}]}], "}"}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{"(*", " ", 
                   RowBox[{
                   "Then", " ", "handle", " ", "the", " ", "left", " ", "and",
                     " ", "right", " ", "boundary"}], " ", "*)"}], 
                  "\[IndentingNewLine]", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Mod", "[", 
                    RowBox[{"i", ",", "sqrtlenfpoints"}], "]"}], "\[Equal]", 
                    "1"}], ",", " ", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"i", "-", "sqrtlenfpoints"}], ",", " ", 
                    RowBox[{"i", "+", "1"}], ",", " ", 
                    RowBox[{"i", "+", "sqrtlenfpoints"}]}], "}"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Mod", "[", 
                    RowBox[{"i", ",", " ", "sqrtlenfpoints"}], "]"}], 
                    "\[Equal]", "0"}], ",", " ", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"i", "-", "sqrtlenfpoints"}], ",", " ", 
                    RowBox[{"i", "-", "1"}], ",", " ", 
                    RowBox[{"i", "+", "sqrtlenfpoints"}]}], "}"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"(*", " ", 
                    RowBox[{
                    "Otherwise", " ", "you", " ", "have", " ", "four", " ", 
                    "neighbors"}], " ", "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"i", "-", "sqrtlenfpoints"}], ",", " ", 
                    RowBox[{"i", "-", "1"}], ",", " ", 
                    RowBox[{"i", "+", "1"}], ",", " ", 
                    RowBox[{"i", "+", "sqrtlenfpoints"}]}], "}"}]}], 
                    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
                   "]"}]}], "\[IndentingNewLine]", "]"}]}], 
               "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}],
            "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
       "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "Convert", " ", "x", " ", "and", " ", "y", " ", "coordinate", " ", "to", 
    " ", "the", " ", "index", " ", "number", " ", "of", " ", "the", " ", 
    "list"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"xytoi", " ", "=", " ", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"point", ",", " ", "_Real", ",", " ", "1"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"fpoints", ",", " ", "_Real", ",", " ", "2"}], "}"}]}], 
       "}"}], ",", 
      RowBox[{
       RowBox[{"Position", "[", 
        RowBox[{"fpoints", ",", " ", "point"}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"Transition", " ", "rate", " ", "to", " ", "the", " ", "right"}], 
   " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Wright", " ", "=", " ", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x", ",", " ", "_Real"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"y", ",", " ", "_Real"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"h", ",", " ", "_Real"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"Diffusion", ",", " ", "_Real"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"k", ",", " ", "_Real"}], "}"}]}], "}"}], ",", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"f", "[", 
           RowBox[{"x", ",", "y", ",", "k"}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], " ", "/", " ", 
         RowBox[{"(", 
          RowBox[{"2", "h"}], ")"}]}], ")"}], " ", "+", " ", 
       RowBox[{"(", 
        RowBox[{"Diffusion", " ", "/", " ", 
         RowBox[{"h", "^", "2"}]}], ")"}]}]}], "]"}]}], ";"}], "\n", 
  RowBox[{"(*", " ", 
   RowBox[{"Transition", " ", "rate", " ", "to", " ", "the", " ", "left"}], 
   " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Wleft", " ", "=", " ", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x", ",", " ", "_Real"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"y", ",", " ", "_Real"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"h", ",", " ", "_Real"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"Diffusion", ",", " ", "_Real"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"k", ",", " ", "_Real"}], "}"}]}], "}"}], ",", 
      RowBox[{
       RowBox[{"-", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"f", "[", 
            RowBox[{"x", ",", "y", ",", "k"}], "]"}], " ", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "/", " ", 
          RowBox[{"(", 
           RowBox[{"2", "h"}], ")"}]}], ")"}]}], " ", "+", " ", 
       RowBox[{"(", 
        RowBox[{"Diffusion", " ", "/", " ", 
         RowBox[{"h", "^", "2"}]}], ")"}]}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"Transition", " ", "rate", " ", "up"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Wup", " ", "=", " ", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x", ",", " ", "_Real"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"y", ",", " ", "_Real"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"h", ",", " ", "_Real"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"Diffusion", ",", " ", "_Real"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"k", ",", " ", "_Real"}], "}"}]}], "}"}], ",", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"f", "[", 
           RowBox[{"x", ",", "y", ",", "k"}], "]"}], " ", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "/", " ", 
         RowBox[{"(", 
          RowBox[{"2", "h"}], ")"}]}], ")"}], " ", "+", " ", 
       RowBox[{"(", 
        RowBox[{"Diffusion", " ", "/", " ", 
         RowBox[{"h", "^", "2"}]}], ")"}]}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"Transition", " ", "rate", " ", "down"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Wdown", " ", "=", " ", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x", ",", " ", "_Real"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"y", ",", " ", "_Real"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"h", ",", " ", "_Real"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"Diffusion", ",", " ", "_Real"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"k", ",", " ", "_Real"}], "}"}]}], "}"}], ",", 
      RowBox[{
       RowBox[{"-", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"f", "[", 
            RowBox[{"x", ",", "y", ",", "k"}], "]"}], " ", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "/", " ", 
          RowBox[{"(", 
           RowBox[{"2", "h"}], ")"}]}], ")"}]}], " ", "+", " ", 
       RowBox[{"(", 
        RowBox[{"Diffusion", " ", "/", " ", 
         RowBox[{"h", "^", "2"}]}], ")"}]}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{"xmax", " ", "=", " ", "50."}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"xmin", " ", "=", " ", 
   RowBox[{"-", "50."}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ymax", " ", "=", " ", "20."}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ymin", " ", "=", " ", 
   RowBox[{"-", "20."}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Diffusion", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{"250.", ",", "25."}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"h", " ", "=", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"100.", ",", "40."}], "}"}], "/", "99."}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "points", " ", "is", " ", "the", " ", "location", " ", "of", " ", "the", 
    " ", "grid", " ", "points"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"points", " ", "=", " ", 
    RowBox[{"N", "[", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"x", ",", " ", "y"}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"x", ",", " ", "xmin", ",", " ", "xmax", ",", " ", 
         RowBox[{"h", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"y", ",", " ", "ymin", ",", " ", "ymax", ",", " ", 
         RowBox[{"h", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "Rounded", " ", "and", " ", "flattened", " ", "version", " ", "of", " ", 
    "points"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fpoints", " ", "=", " ", 
   RowBox[{"Round", "[", 
    RowBox[{
     RowBox[{"Flatten", "[", 
      RowBox[{"points", ",", " ", "1"}], "]"}], ",", 
     RowBox[{
      RowBox[{"h", "[", 
       RowBox[{"[", "2", "]"}], "]"}], "/", "400000"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"xpoints", " ", "=", " ", 
   RowBox[{"N", "[", 
    RowBox[{"Table", "[", 
     RowBox[{"x", ",", " ", 
      RowBox[{"{", 
       RowBox[{"x", ",", " ", "xmin", ",", " ", "xmax", ",", " ", 
        RowBox[{"h", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ypoints", " ", "=", " ", 
    RowBox[{"N", "[", 
     RowBox[{"Table", "[", 
      RowBox[{"y", ",", " ", 
       RowBox[{"{", 
        RowBox[{"y", ",", " ", "ymin", ",", " ", "ymax", ",", " ", 
         RowBox[{"h", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"Print", " ", "to", " ", 
    RowBox[{"notebook", ".", " ", "Note"}], " ", 
    RowBox[{"that", " ", "<>", " ", "is"}], " ", "a", " ", "string", " ", 
    RowBox[{"concatenation", "."}]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", "[", 
   RowBox[{"\"\<h = \>\"", "<>", 
    RowBox[{"ToString", "[", "h", "]"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", "[", "\"\<Computing edges\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"time", " ", "=", " ", 
   RowBox[{
    RowBox[{"Timing", "[", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "edges", " ", "is", " ", "a", " ", "list", " ", "of", " ", "pairs", " ",
        "of", " ", "vertex", " ", "numbers", " ", "that", " ", "are", " ", 
       "connected", " ", "by", " ", "an", " ", "edge"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"edges", " ", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i", ",", " ", "j"}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "fpoints", "]"}]}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"j", ",", " ", 
             RowBox[{"AllNeighbors", "[", 
              RowBox[{"i", ",", " ", 
               RowBox[{"Sqrt", "[", 
                RowBox[{"Length", "[", "fpoints", "]"}], "]"}]}], "]"}]}], 
            "}"}]}], "]"}], ",", "1"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"edges", " ", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"i", ",", " ", 
              RowBox[{"xytoi", "[", 
               RowBox[{"point1", ",", " ", "fpoints"}], "]"}]}], "}"}], ",", 
            " ", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", 
              RowBox[{"Length", "[", "fpoints", "]"}]}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"point1", ",", " ", 
              RowBox[{"AllNeighbors", "[", 
               RowBox[{
                RowBox[{"fpoints", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], ",", " ", "fpoints", ",", 
                " ", "h"}], "]"}]}], "}"}]}], "]"}], ",", "1"}], "]"}]}], 
       ";"}], "*)"}], "\[IndentingNewLine]", "]"}], "[", 
    RowBox[{"[", "1", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Print", "[", 
    RowBox[{"\"\<Computed edges in \>\"", "<>", 
     RowBox[{"ToString", "[", "time", "]"}], "<>", "\"\< seconds\>\""}], 
    "]"}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", "[", "\"\<Constructing Rate Matrix\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"time", " ", "=", " ", 
   RowBox[{
    RowBox[{"Timing", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"W", " ", "=", " ", 
       RowBox[{"SparseArray", "[", "\[IndentingNewLine]", 
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "i", " ", "and", " ", "j", " ", "are", " ", "indices", " ", "of", 
           " ", "the", " ", 
           RowBox[{"vertices", " ", "--"}], " ", "they", " ", "are", " ", 
           "integers"}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"i", ",", "j"}], "}"}], "=", "edge"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
            "point", " ", "1", " ", "and", " ", "point2", " ", "are", " ", 
             "the", " ", "coordinates", " ", "of", " ", "those", " ", 
             RowBox[{"indices", " ", "--"}], " ", "they", " ", 
             RowBox[{"aren", "'"}], "t", " ", "integers"}], " ", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"point1", " ", "=", " ", 
            RowBox[{"fpoints", "[", 
             RowBox[{"[", "j", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"point2", " ", "=", " ", 
            RowBox[{"fpoints", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{"This", " ", "sets", " ", "the", " ", 
              RowBox[{"W", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", " ", "j"}], "]"}], "]"}], " ", "matrix", 
              " ", "element"}], ",", " ", 
             RowBox[{
             "which", " ", "is", " ", "the", " ", "rate", " ", "from", " ", 
              "index", " ", "j", " ", "to", " ", "index", " ", "i"}]}], " ", 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"i", ",", "j"}], "}"}], "\[Rule]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"point1", " ", "-", " ", "point2"}], " ", "==", " ", 
               RowBox[{"{", 
                RowBox[{"0", ",", " ", 
                 RowBox[{"h", "[", 
                  RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], ",", 
              RowBox[{"Wdown", "[", 
               RowBox[{
                RowBox[{"point1", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
                RowBox[{"point1", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
                RowBox[{"h", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
                RowBox[{"Diffusion", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], ",", " ", "k"}], "]"}], ",", 
              " ", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"point1", " ", "-", " ", "point2"}], " ", "==", " ", 
                 
                 RowBox[{"{", 
                  RowBox[{"0", ",", " ", 
                   RowBox[{"-", 
                    RowBox[{"h", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}]}], ",", 
                RowBox[{"Wup", "[", 
                 RowBox[{
                  RowBox[{"point1", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
                  RowBox[{"point1", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
                  RowBox[{"h", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
                  RowBox[{"Diffusion", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], ",", " ", "k"}], "]"}], 
                ",", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"point1", " ", "-", " ", "point2"}], " ", "==", 
                   " ", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"h", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", " ", "0"}], "}"}]}], 
                  ",", " ", "\[IndentingNewLine]", 
                  RowBox[{"Wleft", "[", 
                   RowBox[{
                    RowBox[{"point1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
                    RowBox[{"point1", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
                    RowBox[{"h", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
                    RowBox[{"Diffusion", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", " ", "k"}], "]"}], 
                  ",", "\[IndentingNewLine]", 
                  RowBox[{"Wright", "[", 
                   RowBox[{
                    RowBox[{"point1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
                    RowBox[{"point1", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
                    RowBox[{"h", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
                    RowBox[{"Diffusion", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", "k"}], "]"}]}], 
                 "]"}]}], "]"}]}], "]"}]}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{"edge", ",", " ", "edges"}], "}"}]}], 
         "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"tot", " ", "=", " ", 
       RowBox[{"Total", "[", 
        RowBox[{"W", ",", " ", 
         RowBox[{"{", "1", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Wdiag", " ", "=", " ", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"i", ",", " ", "i"}], "}"}], "->", 
          RowBox[{"tot", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", " ", "1", ",", 
           RowBox[{"Length", "[", "fpoints", "]"}]}], "}"}]}], 
        "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"W", " ", "-=", 
       RowBox[{"SparseArray", "[", "Wdiag", "]"}]}], ";"}], 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}], "[", 
    RowBox[{"[", "1", "]"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Print", "[", 
   RowBox[{"\"\<Rate matrix computed in \>\"", "<>", 
    RowBox[{"ToString", "[", "time", "]"}], " ", "<>", "\"\< seconds\>\""}], 
   "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.7016212775918093`*^9, 3.701621288941388*^9}, {
   3.7016213647380466`*^9, 3.701621368549757*^9}, {3.701636396601994*^9, 
   3.7016363991864347`*^9}, {3.701636997471614*^9, 3.701636997817974*^9}, {
   3.701637106880599*^9, 3.701637107835025*^9}, {3.70163714874396*^9, 
   3.7016371488879232`*^9}, {3.7016372082915907`*^9, 
   3.7016372086499357`*^9}, {3.701637270550337*^9, 3.7016373620147943`*^9}, {
   3.7016872613584347`*^9, 3.701687268671488*^9}, {3.701687307599288*^9, 
   3.701687309307283*^9}, 3.7027480009122458`*^9, {3.704729035397512*^9, 
   3.704729036118988*^9}, {3.707145108581891*^9, 
   3.70714511882803*^9}},ExpressionUUID->"09f8d08b-0076-4434-bcae-\
05785ef738e0"],

Cell[CellGroupData[{

Cell[BoxData["\<\"h = {1.0101, 0.40404}\"\>"], "Print",
 CellChangeTimes->{3.7071452451214037`*^9, 3.7071648521622133`*^9, 
  3.707216139774802*^9},ExpressionUUID->"aa458cc4-6f5e-4896-8a38-\
e61d7e486922"],

Cell[BoxData["\<\"Computing edges\"\>"], "Print",
 CellChangeTimes->{3.7071452451214037`*^9, 3.7071648521622133`*^9, 
  3.7072161397866488`*^9},ExpressionUUID->"dd54b64d-018d-45b3-b86b-\
581c9d0c6f43"],

Cell[BoxData["\<\"Computed edges in 0.037438 seconds\"\>"], "Print",
 CellChangeTimes->{3.7071452451214037`*^9, 3.7071648521622133`*^9, 
  3.7072161398701563`*^9},ExpressionUUID->"c12777a7-9c8f-4d37-b735-\
3978d1c906d0"],

Cell[BoxData["\<\"Constructing Rate Matrix\"\>"], "Print",
 CellChangeTimes->{3.7071452451214037`*^9, 3.7071648521622133`*^9, 
  3.7072161398843184`*^9},ExpressionUUID->"5da4c74b-403b-481a-8404-\
3ae2fee466f3"],

Cell[BoxData["\<\"Rate matrix computed in 0.354719 seconds\"\>"], "Print",
 CellChangeTimes->{3.7071452451214037`*^9, 3.7071648521622133`*^9, 
  3.707216140174782*^9},ExpressionUUID->"4c5dfc3d-80e4-45e5-86f2-\
909647240fcd"]
}, Open  ]]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"J", " ", "=", " ", 
   RowBox[{"SparseArray", "[", "\[IndentingNewLine]", 
    RowBox[{"Table", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"i", ",", "j"}], "}"}], "=", "edge"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"i", ",", "j"}], "}"}], "\[Rule]", "0"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"edge", ",", " ", "edges"}], "}"}]}], "\[IndentingNewLine]", 
     "]"}], "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.702751620695752*^9, 3.7027516261530333`*^9}, {
  3.7027520816422873`*^9, 
  3.70275210549059*^9}},ExpressionUUID->"bd518599-e4f6-4e15-8982-\
48e663c93f83"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Stepv2", "[", "Config_", "]"}], ":=", " ", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "r", ",", "tau", ",", "NextJump", ",", "oldsite", ",", "oldtime", ",", 
      "newsite", ",", "newtime", ",", " ", "acumrates", ",", " ", 
      "sqrtlfpoints", ",", " ", "Wdiag"}], "}"}], ",", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"oldsite", ",", " ", "oldtime"}], "}"}], " ", "=", " ", 
      "Config"}], ";", "\[IndentingNewLine]", 
     RowBox[{"sqrtlfpoints", " ", "=", " ", 
      RowBox[{"Sqrt", "[", 
       RowBox[{"Length", "[", "fpoints", "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Wdiag", " ", "=", " ", 
      RowBox[{"W", "[", 
       RowBox[{"[", 
        RowBox[{"oldsite", ",", " ", "oldsite"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"acumrates", " ", "=", " ", 
      RowBox[{
       RowBox[{"Accumulate", "[", 
        RowBox[{"W", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"AllNeighbors", "[", 
            RowBox[{"oldsite", ",", " ", "sqrtlfpoints"}], "]"}], ",", " ", 
           "oldsite"}], "]"}], "]"}], "]"}], "/", 
       RowBox[{"(", 
        RowBox[{"-", "Wdiag"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"r", "=", 
      RowBox[{"RandomReal", "[", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"tau", "=", 
      RowBox[{
       RowBox[{"Log", "[", 
        RowBox[{"RandomReal", "[", "]"}], "]"}], "/", 
       RowBox[{"(", "Wdiag", ")"}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "oldsite", ";", "\[IndentingNewLine]", 
     RowBox[{"NextJump", "=", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"r", "<", 
         RowBox[{"acumrates", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ",", " ", "1", ",", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"r", "<", 
           RowBox[{"acumrates", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], ",", " ", "2", ",", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"r", "<", 
             RowBox[{"acumrates", "[", 
              RowBox[{"[", "3", "]"}], "]"}]}], ",", " ", "3", ",", "4"}], 
           "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
       "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"newsite", "=", 
      RowBox[{
       RowBox[{"AllNeighbors", "[", 
        RowBox[{"oldsite", ",", " ", "sqrtlfpoints"}], "]"}], "[", 
       RowBox[{"[", "NextJump", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"J", "[", 
       RowBox[{"[", 
        RowBox[{"oldsite", ",", "newsite"}], "]"}], "]"}], " ", "=", " ", 
      RowBox[{
       RowBox[{"J", "[", 
        RowBox[{"[", 
         RowBox[{"oldsite", ",", "newsite"}], "]"}], "]"}], " ", "-", " ", 
       "1"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"J", "[", 
       RowBox[{"[", 
        RowBox[{"newsite", ",", "oldsite"}], "]"}], "]"}], " ", "=", " ", 
      RowBox[{
       RowBox[{"J", "[", 
        RowBox[{"[", 
         RowBox[{"newsite", ",", "oldsite"}], "]"}], "]"}], " ", "+", " ", 
       "1"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"newtime", "=", 
      RowBox[{"oldtime", "+", "tau"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"ConfigNew", "=", 
      RowBox[{"{", 
       RowBox[{"newsite", ",", "newtime"}], "}"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->CompressedData["
1:eJwd0Wkow3EAxvFhRZQkuYockeVIoSYkZ5LcRZpIYcRGyVwZKeaIWci1Qiw1
5YxyrIWMzDFWLEdIrLkyTNgLv+f/4unT8/rrXsBNLzSl0WieZHA5O6smpe8p
SrKzXQuNt4mdsE3CEcFSf2ZPMbEqRSeE8ZG+gzAhY24Ubv/lTsH2oXIpTLd4
nYVverkCcjSMByhKTdNB7ZFQDwcdpZSG7sNvqEtQ/MBWkxA7NvFKVUe5d8aX
wVXXiy14rtXsQrmgRQk7xMMquGvurYaJ4kyvEmLjuUkwZAY4r8Prj64NaH08
Fs0lfhoFMXA6iB5Wgc9PCofPLJt8aHihs6EoqbcJzi+pKNVW65PQ7dRpBso2
pQvQ9MZvBX4U7cigw5pyE2ZqxCpoLfTRQLNU2TtkJft9Q0sdw72SWD3A84Ty
ieJgGFjZQMlhleVBe6UbGyaH8A44A09RcXruIdyPoHlwiQ1pi97Q5avwHjr+
Xj7CkdAcA1Q/lFGanzD5FUT6+GcztBGru6DFVZwQ9t8x3m2HSe/GWMq5kwgD
5JnVU/4DJI4ulA==
  "],ExpressionUUID->"6559aef8-d3f4-42b6-a366-0d0ed285a31e"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Print", "[", "\"\<Generate Two Beads Jumps\>\"", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"time", "=", 
    RowBox[{
     RowBox[{"Timing", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Config", "=", 
        RowBox[{"{", 
         RowBox[{"5050", ",", "0"}], "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"something", "=", "0"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Configuration", "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"{", 
              RowBox[{"5050", ",", "0"}], "}"}], "}"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Config", "=", 
               RowBox[{"Stepv2", "[", "Config", "]"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "1000000"}], "}"}]}], 
             "\[IndentingNewLine]", "]"}]}], "}"}], ",", "1"}], "]"}]}], 
       ";"}], "\[IndentingNewLine]", "]"}], "[", 
     RowBox[{"[", "1", "]"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", "[", 
   RowBox[{"\"\<Generated Two Beads Jumps in \>\"", "<>", 
    RowBox[{"ToString", "[", "time", "]"}], "<>", "\"\< seconds\>\""}], "]"}],
   ";"}]}], "Input",
 CellChangeTimes->{{3.7016271509286947`*^9, 3.701627653755262*^9}, {
   3.701627806389944*^9, 3.7016278183365927`*^9}, {3.701630304889089*^9, 
   3.701630323685399*^9}, {3.701631075300408*^9, 3.701631077335732*^9}, {
   3.701631115103538*^9, 3.701631121842123*^9}, {3.7016314699967413`*^9, 
   3.7016314886605864`*^9}, {3.701636029693233*^9, 3.701636043937484*^9}, {
   3.701636413315721*^9, 3.7016364220459833`*^9}, {3.7016858277910852`*^9, 
   3.701685863611177*^9}, {3.7016859575073566`*^9, 3.701685983809533*^9}, {
   3.701686465945458*^9, 3.701686466348716*^9}, {3.701686561246703*^9, 
   3.701686563922929*^9}, {3.70168804663104*^9, 3.701688050601156*^9}, {
   3.7016881121757174`*^9, 3.7016881396152782`*^9}, {3.701688722045546*^9, 
   3.701688746255601*^9}, 3.7016888335813627`*^9, 3.701689851222102*^9, {
   3.70170300731246*^9, 3.701703010395053*^9}, {3.701703626972187*^9, 
   3.7017036327201443`*^9}, {3.7017036740431023`*^9, 
   3.7017037302043962`*^9}, {3.7017038147633677`*^9, 3.701703846859475*^9}, {
   3.701703882534288*^9, 3.701703945581296*^9}, {3.701704351708951*^9, 
   3.701704355381236*^9}, {3.7017044196840677`*^9, 3.7017044906952*^9}, {
   3.701704521802827*^9, 3.701704576659316*^9}, {3.701704708222679*^9, 
   3.7017047101222897`*^9}, {3.701704813187271*^9, 3.7017048163369293`*^9}, {
   3.701704896159404*^9, 3.7017049537489147`*^9}, 3.701704998897752*^9, {
   3.701705129243745*^9, 3.701705130998478*^9}, {3.701705195441256*^9, 
   3.701705270785281*^9}, {3.701705303309394*^9, 3.70170530408506*^9}, {
   3.701705561258545*^9, 3.701705561639606*^9}, {3.701705937008897*^9, 
   3.701705937289077*^9}, {3.7017060979113693`*^9, 3.7017061090598993`*^9}, 
   3.7017067852645483`*^9, 3.701707172861068*^9, {3.701707911021098*^9, 
   3.701707911154482*^9}, 3.701707953613195*^9, 3.701708195002595*^9, {
   3.701709264316197*^9, 3.701709266148473*^9}, {3.701709323819192*^9, 
   3.7017093239864607`*^9}, {3.702748308636858*^9, 3.702748309176203*^9}, {
   3.702748339836433*^9, 3.7027483400366993`*^9}, {3.70274892828335*^9, 
   3.70274892851869*^9}, {3.7027521954038353`*^9, 3.70275219638168*^9}, {
   3.702752390807061*^9, 3.702752395453072*^9}, 3.702752765889357*^9, {
   3.704728974205782*^9, 3.7047289767011433`*^9}, {3.704729259385303*^9, 
   3.704729262601346*^9}, {3.7047294546099586`*^9, 3.704729455046344*^9}, 
   3.7047311979469357`*^9},ExpressionUUID->"36122c44-1fcb-4f2e-a49d-\
914c9a31360a"],

Cell[CellGroupData[{

Cell[BoxData["\<\"Generate Two Beads Jumps\"\>"], "Print",
 CellChangeTimes->{3.70275211873803*^9, 3.7027522744703417`*^9, 
  3.702752454176937*^9, 3.7027527666442413`*^9, 3.702761390857936*^9, 
  3.7027619916591377`*^9, 3.702762642450075*^9, 3.7046534874776278`*^9, 
  3.704655296625018*^9, 3.704723758192428*^9, 3.7047247399206867`*^9, 
  3.704725360658087*^9, 3.704728980898346*^9, 3.704729056409898*^9, 
  3.70472927575327*^9, 3.7047294692466717`*^9, 3.704731209659235*^9, 
  3.705945815200979*^9, 3.707145249081378*^9, 3.7071648567538567`*^9, 
  3.707216145516244*^9},ExpressionUUID->"e81484d6-4004-403f-95a2-\
0a8d5c7feafd"],

Cell[BoxData["\<\"Generated Two Beads Jumps in 80.5886 seconds\"\>"], "Print",
 CellChangeTimes->{3.70275211873803*^9, 3.7027522744703417`*^9, 
  3.702752454176937*^9, 3.7027527666442413`*^9, 3.702761390857936*^9, 
  3.7027619916591377`*^9, 3.702762642450075*^9, 3.7046534874776278`*^9, 
  3.704655296625018*^9, 3.704723758192428*^9, 3.7047247399206867`*^9, 
  3.704725360658087*^9, 3.704728980898346*^9, 3.704729056409898*^9, 
  3.70472927575327*^9, 3.7047294692466717`*^9, 3.704731209659235*^9, 
  3.705945815200979*^9, 3.707145249081378*^9, 3.7071648567538567`*^9, 
  3.7072162262342052`*^9},ExpressionUUID->"fd128d2c-7f82-4962-b159-\
1a85c6b0938e"]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1722, 1133},
WindowMargins->{{Automatic, 144}, {Automatic, 0}},
FrontEndVersion->"11.1 for Mac OS X x86 (32-bit, 64-bit Kernel) (March 16, \
2017)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 942, 28, 54, "Input", "ExpressionUUID" -> \
"3b5728da-ab62-4d0f-8732-7c8ae4d521ee"],
Cell[1525, 52, 14921, 318, 60, "Output", "ExpressionUUID" -> \
"2a250249-224a-4a78-8a99-15510819864c"]
}, Open  ]],
Cell[CellGroupData[{
Cell[16483, 375, 24292, 597, 1818, "Input", "ExpressionUUID" -> \
"eac07ec0-a4a3-47ad-a98f-60d5bca6c737"],
Cell[CellGroupData[{
Cell[40800, 976, 205, 3, 24, "Print", "ExpressionUUID" -> \
"3378cd2d-e62c-4e09-87de-1a9714726233"],
Cell[41008, 981, 201, 3, 24, "Print", "ExpressionUUID" -> \
"d9ebe076-55e8-43b4-848f-4f64e550aea4"],
Cell[41212, 986, 220, 3, 24, "Print", "ExpressionUUID" -> \
"c0f2d476-7395-416e-b1fd-e11bc6cd735a"],
Cell[41435, 991, 210, 3, 24, "Print", "ExpressionUUID" -> \
"0fb7f2d8-bf54-4fdb-b3fd-47983f43ef6c"],
Cell[41648, 996, 224, 3, 24, "Print", "ExpressionUUID" -> \
"0fba257b-5854-4a74-a39c-d32b35c5e0ac"]
}, Open  ]]
}, Open  ]],
Cell[41899, 1003, 790, 21, 159, "Input", "ExpressionUUID" -> \
"bd2bd256-0782-4429-95fe-da83524fb99b"],
Cell[42692, 1026, 4364, 105, 558, "Input", "ExpressionUUID" -> \
"9b050d3a-177b-423f-9e18-37035b8c0254"],
Cell[CellGroupData[{
Cell[47081, 1135, 3925, 73, 285, "Input", "ExpressionUUID" -> \
"36122c44-1fcb-4f2e-a49d-914c9a31360a"],
Cell[CellGroupData[{
Cell[51031, 1212, 630, 9, 24, "Print", "ExpressionUUID" -> \
"75d61d7b-47dc-4d55-aed4-2da491b4c4fd"],
Cell[51664, 1223, 652, 9, 24, "Print", "ExpressionUUID" -> \
"165aaaac-5143-4086-ac3e-573cb3b11380"]
}, Open  ]]
}, Open  ]]
}
]
*)

